#!/usr/bin/env bash

set -euxo pipefail
env -i bash -c '(source testing-env.sh; env >test.env)'

prog=$1
shift

@KLEE_BINARY@ "$@" \
    --simplify-sym-indices \
    --write-cvcs \
    --write-cov \
    --output-module \
    --disable-inlining \
    --optimize \
    --use-forked-solver \
    --use-cex-cache \
    --libc=uclibc \
    --posix-runtime \
    --allow-external-sym-calls \
    --only-output-states-covering-new \
    --environ=test.env \
    --run-in=sandbox \
    --max-sym-array-size=4096 \
    --max-instruction-time=320. \
    --max-memory=10000 \
    --max-time=28800. \
    --watchdog \
    --max-memory-inhibit=false \
    --max-static-fork-pct=1 \
    --max-static-solve-pct=1 \
    --max-static-cpfork-pct=1 \
    --switch-type=internal \
    --search=random-path \
    --search=nurs:covnew \
    --use-batching-search \
    --batch-instructions=10000 \
    --emit-all-errors \
    --write-paths \
    "./coreutils-6.10-llvm-prefix/bin/$prog" \
    --sym-args 0 1 10 \
    --sym-args 0 2 2  \
    --sym-files 1 8 \
    --sym-stdin 8 \
    --sym-stdout
   #--max-instruction-time=60. \
   #--max-memory=4000 \
   #--max-time=3600. \
